<?xml version="1.0"?>
<!-- Copyright 2025 HelixScreen -->
<!-- SPDX-License-Identifier: GPL-3.0-or-later -->

<!-- AMS Panel - Multi-filament unit visualization and control

     Displays a Bambu-inspired visualization of multi-filament units
     (Happy Hare, AFC) with colored slots, status indicators, and
     load/unload operations.

     Layout:
     - Header bar with "Multi-Filament" title
     - Slot grid: flexible layout, up to 8 slots (wraps based on screen width)
     - Status display with current action detail
     - Action buttons: Unload, Home
     - Progress spinner (hidden when idle)

     Slot visibility:
       C++ hides slots beyond the configured gate_count.
       All 8 slots are defined in XML; unused ones are hidden.

     Named widgets for C++ access:
       - overlay_header: header_bar component
       - overlay_content: main content area
       - slot_grid: container for slot widgets
       - slot_0..slot_7: individual ams_slot components
       - status_label: bound to ams_action_detail subject
       - action_progress: lv_spinner (hidden by default)
       - btn_unload: unload button
       - btn_home: home button

     Reactive bindings:
       - status_label bind_text="ams_action_detail"
       - action_progress visibility controlled by C++ based on ams_action

     See: ui_panel_ams.cpp for C++ integration
-->
<component>
  <!-- Overlay panel - right-aligned, uses standard width -->
  <view extends="lv_obj" name="ams_panel"
        width="#overlay_panel_width_large" height="100%"
        align="right_mid"
        style_pad_all="0" style_border_width="0"
        style_bg_opa="255" style_bg_color="#card_bg"
        scrollable="false"
        flex_flow="column">

    <!-- Header Bar -->
    <header_bar name="overlay_header" title="Multi-Filament"/>

    <!-- Content Area -->
    <lv_obj name="overlay_content"
            flex_grow="1" width="100%"
            style_bg_opa="0"
            style_pad_all="#space_lg"
            style_pad_gap="#space_lg"
            scrollable="false"
            style_border_width="0"
            flex_flow="column"
            style_flex_main_place="start"
            style_flex_cross_place="center">

      <!-- Slot Grid Container
           Uses row_wrap to automatically arrange slots.
           Slots have flex_grow with min/max constraints for responsive sizing.
           On smaller screens: 4 per row (2 rows for 8 slots)
           On larger screens: up to 8 per row if space permits
           C++ hides slots beyond gate_count -->
      <lv_obj name="slot_grid"
              width="100%"
              height="content"
              style_bg_opa="0"
              style_border_width="0"
              style_pad_all="0"
              style_pad_row="#space_md"
              style_pad_column="#space_sm"
              flex_flow="row_wrap"
              style_flex_main_place="center"
              style_flex_cross_place="start"
              scrollable="false">

        <!-- All 8 slots defined - C++ hides unused slots based on gate_count -->
        <ams_slot name="slot_0" slot_number="0"/>
        <ams_slot name="slot_1" slot_number="1"/>
        <ams_slot name="slot_2" slot_number="2"/>
        <ams_slot name="slot_3" slot_number="3"/>
        <ams_slot name="slot_4" slot_number="4"/>
        <ams_slot name="slot_5" slot_number="5"/>
        <ams_slot name="slot_6" slot_number="6"/>
        <ams_slot name="slot_7" slot_number="7"/>

      </lv_obj>

      <!-- Status Section -->
      <lv_obj width="100%" height="content"
              style_bg_opa="0" style_border_width="0"
              style_pad_all="#space_md"
              flex_flow="row"
              style_flex_main_place="center"
              style_flex_cross_place="center"
              style_pad_gap="#space_md"
              scrollable="false">

        <!-- Progress spinner (hidden by default, shown during operations) -->
        <lv_spinner name="action_progress"
                    width="32" height="32"
                    style_arc_width:indicator="3"
                    style_arc_color="#primary_color"
                    style_arc_opa:main="0"
                    hidden="true"/>

        <!-- Status label - bound to ams_action_detail subject -->
        <text_body name="status_label"
                   bind_text="ams_action_detail"
                   style_text_align="center"
                   flex_grow="1"/>

      </lv_obj>

      <!-- Spacer to push buttons toward bottom -->
      <lv_obj flex_grow="1" style_bg_opa="0" style_border_width="0" scrollable="false"/>

      <!-- Action Buttons Row -->
      <lv_obj width="100%" height="content"
              style_bg_opa="0" style_border_width="0"
              style_pad_all="0"
              style_pad_gap="#space_lg"
              flex_flow="row"
              style_flex_main_place="center"
              style_flex_cross_place="center"
              scrollable="false">

        <!-- Unload Button -->
        <lv_button name="btn_unload"
                   height="#button_height"
                   style_min_width="120"
                   style_radius="#border_radius"
                   style_border_width="0"
                   style_shadow_width="0"
                   flex_flow="row"
                   style_flex_main_place="center"
                   style_flex_cross_place="center"
                   style_pad_gap="#space_xs">
          <icon src="z_farther" size="sm" variant="primary"/>
          <text_body text="Unload"/>
        </lv_button>

        <!-- Home Button -->
        <lv_button name="btn_home"
                   height="#button_height"
                   style_min_width="120"
                   style_radius="#border_radius"
                   style_border_width="0"
                   style_shadow_width="0"
                   flex_flow="row"
                   style_flex_main_place="center"
                   style_flex_cross_place="center"
                   style_pad_gap="#space_xs">
          <icon src="home" size="sm" variant="primary"/>
          <text_body text="Home"/>
        </lv_button>

      </lv_obj>

    </lv_obj>

  </view>
</component>
